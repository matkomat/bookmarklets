String.prototype.removeAccents = function() {

    var removalMap = {
        'A'  : /[A?AAÁÂ????AAÃ??????ÄA?A?A??????¥]/g,
        'AA' : /[?]/g,
        'AE' : /[A??]/g,
        'AO' : /[?]/g,
        'AU' : /[?]/g,
        'AV' : /[??]/g,
        'AY' : /[?]/g,
        'B'  : /[B?B??????]/g,
        'C'  : /[C?CÆCCÈÇ????]/g,
        'D'  : /[D?D?Ï????Ð??Ð?]/g,
        'DZ' : /[??]/g,
        'Dz' : /[??]/g,
        'E'  : /[E?EEÉE?????E??EEË?Ì??????Ê????]/g,
        'F'  : /[F?F?F?]/g,
        'G'  : /[G?G?G?GGGGG????]/g,
        'H'  : /[H?HH??????H???]/g,
        'I'  : /[I?IIÍÎIIIII??I???I?I]/g,
        'J'  : /[J?JJ?]/g,
        'K'  : /[K?K?K?K???????]/g,
        'L'  : /[L?L?Å¼??L??£??????]/g,
        'LJ' : /[?]/g,
        'Lj' : /[?]/g,
        'M'  : /[M?M?????]/g,
        'N'  : /[N?N?ÑN?Ò?N??????]/g,
        'NJ' : /[?]/g,
        'Nj' : /[?]/g,
        'O'  : /[O?OOÓÔ????O???O??O??Ö??ÕO??O???????OOO??O??]/g,
        'OI' : /[?]/g,
        'OO' : /[?]/g,
        'OU' : /[?]/g,
        'P'  : /[P?P???????]/g,
        'Q'  : /[Q?Q???]/g,
        'R'  : /[R?RÀ?Ø????R??????]/g,
        'S'  : /[S?S?Œ?S?Š????ª???]/g,
        'T'  : /[T?T???Þ??T?T??]/g,
        'TZ' : /[?]/g,
        'U'  : /[U?UUÚUU?U?UÜUUUU?ÙÛU??U???????U???]/g,
        'V'  : /[V?V?????]/g,
        'VY' : /[?]/g,
        'W'  : /[W?W??W????]/g,
        'X'  : /[X?X??]/g,
        'Y'  : /[Y?Y?ÝY???Y?????]/g,
        'Z'  : /[Z?Z?¯Ž???????]/g,
        'a'  : /[a?a?aáâ????aaã??????äa?a?a??????¹??]/g,
        'aa' : /[?]/g,
        'ae' : /[a??]/g,
        'ao' : /[?]/g,
        'au' : /[?]/g,
        'av' : /[??]/g,
        'ay' : /[?]/g,
        'b'  : /[b?b???b??]/g,
        'c'  : /[c?cæccèç?????]/g,
        'd'  : /[d?d?ï????ð????]/g,
        'dz' : /[??]/g,
        'e'  : /[e?eeée?????e??eeë?ì??????ê?????]/g,
        'f'  : /[f?f?f?]/g,
        'g'  : /[g?g?g?ggggg????]/g,
        'h'  : /[h?hh???????h???]/g,
        'hv' : /[?]/g,
        'i'  : /[i?iiíîiiii??i???i??i]/g,
        'j'  : /[j?jjj?]/g,
        'k'  : /[k?k?k?k???????]/g,
        'l'  : /[l?l?å¾??l???³l?????]/g,
        'lj' : /[?]/g,
        'm'  : /[m?m?????]/g,
        'n'  : /[n?n?ñn?ò?n???????]/g,
        'nj' : /[?]/g,
        'o'  : /[o?ooóô????o???o??o??ö??õo??o???????ooo?????]/g,
        'oi' : /[?]/g,
        'ou' : /[?]/g,
        'oo' : /[?]/g,
        'p'  : /[p?p???????]/g,
        'q'  : /[q?q???]/g,
        'r'  : /[r?rà?ø????r??????]/g,
        's'  : /[s?sßœ?s?š????º????]/g,
        't'  : /[t?t????þ??t????]/g,
        'tz' : /[?]/g,
        'u'  : /[u?uuúuu?u?uüuuuu?ùûu??u???????u???]/g,
        'v'  : /[v?v?????]/g,
        'vy' : /[?]/g,
        'w'  : /[w?w??w?????]/g,
        'x'  : /[x?x??]/g,
        'y'  : /[y?y?ýy???y??????]/g,
        'z'  : /[z?zŸ?¿ž??z????]/g,
    };

    var str = this;

    for(var latin in removalMap) {
      var nonLatin = removalMap[latin];
      str = str.replace(nonLatin , latin);
    }

    return str;
};


var downloadRename = function (url, fileName) {
window.URL = window.URL || window.webkitURL;

var xhr = new XMLHttpRequest(),
      a = document.createElement('a'), file;

xhr.open('GET', url, true);
xhr.responseType = 'blob';
xhr.onload = function () {
    file = new Blob([xhr.response], { type : 'application/octet-stream' });
    a.href = window.URL.createObjectURL(file);
    a.download = fileName;  // Set to whatever file name you want
    // Now just click the link you created
    // Note that you may have to append the a element to the body somewhere
    // for this to work in Firefox
    a.click();
};
xhr.send();
};


var normalizeName = function(str) {
  var ret = str.replace(/\s+/g,'_');
  ret = ret.removeAccents();
  return ret;
};


$.ajax('https://servis.eposta.hr/eBox/nalog/table/placeniKarticom?sEcho=1&iColumns=7&sColumns=&iDisplayStart=0&iDisplayLength=-1&mDataProp_0=0&mDataProp_1=1&mDataProp_2=2&mDataProp_3=3&mDataProp_4=4&mDataProp_5=5&mDataProp_6=6&sSearch=&bRegex=false&sSearch_0=&bRegex_0=false&bSearchable_0=true&sSearch_1=&bRegex_1=false&bSearchable_1=true&sSearch_2=&bRegex_2=false&bSearchable_2=true&sSearch_3=&bRegex_3=false&bSearchable_3=true&sSearch_4=&bRegex_4=false&bSearchable_4=true&sSearch_5=&bRegex_5=false&bSearchable_5=true&sSearch_6=&bRegex_6=false&bSearchable_6=false&iSortCol_0=3&sSortDir_0=desc&iSortingCols=1&bSortable_0=true&bSortable_1=true&bSortable_2=true&bSortable_3=true&bSortable_4=true&bSortable_5=true&bSortable_6=true',{}).success(
  function(res){
      $(res.aaData).each(function(i,v) {
          //if (i> 3) return;
            var id = v[2];
            var potvrdaHtmlUrl = 'https://servis.eposta.hr/eBox/nalog/potvrda/' + id;
            var potvrdaPdfUrl = 'https://servis.eposta.hr/eBox/nalog/potvrda/generiraj/' + id;
            var primatelj = v[0];
            var opis = v[1]
            var datum = v[3];
            var iznos = v[5];

            var delim = '-_-';
            var fn = normalizeName(datum + delim + 'eposta' + delim + primatelj + delim + opis + delim + iznos);
            var fnHtml = fn + '.html';
            var fnPdf = fn + '.pdf';
            setTimeout(function() {
                downloadRename(potvrdaPdfUrl, fnPdf);
                downloadRename(potvrdaHtmlUrl, fnHtml);
                },4000*i)
            
      });
  });


